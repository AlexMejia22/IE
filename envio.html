<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/envio.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">


    <title>Encuesta</title>

</head>

<body>
    <div class="content">
        <div class="imagen">
            <h1 class="titulo">Encuesta</h1>
            <p class="texto">Por favor, responde las siguientes preguntas utilizando la numeracion del 0 al 4:</p>
            <a href="explicacion.html" target="_blank"><input type="button" class="but"
                    value="Explicacion de la puntuacion"></a>

            <form id="formularioEncuesta" method="post">
                <div class="pregunta1">
                    <p>1-¿Cual es la brecha existente en las habilidades duras requeridas para el manejo deseado de las
                        tecnologias actuales o emergentes?</p>
                    <input class="color" type="number" name="pregunta1" id="primera1">
                </div>


                <div class="pregunta1">
                    <p>2-¿Cual es la brecha existente en habilidades blandas requeridas para afrontar procesos
                        digitales?</p>
                    <input class="color" type="number" name="pregunta1" id="primera2">
                </div>

                <div class="pregunta1">
                    <p>3-¿que tan preparada esta la cultura dentro de la entidad para desarrollar iniciativas de
                        transformacion digital?</p>
                    <input class="color" type="number" name="pregunta1" id="primera3">
                </div>

                <div class="pregunta1">
                    <p>4-¿Qué tan preparados están sus usuarios (ciudadanía y otros) para apropiar y aceptar los cambios
                        de la Entidad frente a su transformación digital?
                    </p>
                    <input class="color" type="number" name="pregunta1" id="primera4">
                </div>

                <div class="pregunta2">
                    <p>5-¿Qué tan amplia es la brecha digital en los procesos clave para llegar al estado ideal en
                        materia de transformación digital?
                    </p>
                    <input class="color" type="number" name="pregunta2" id="segunda1">
                </div>

                <div class="pregunta2">
                    <p>6-¿Hasta qué punto los proyectos de transformación digital pueden mejorar la eficacia y
                        eficiencia los procesos core?
                    </p>
                    <input class="color" type="number" name="pregunta2" id="segunda2">
                </div>

                <div class="pregunta2">
                    <p>7-¿Qué tan efectivo resulta el esquema organizacional existente para llevar adelante un proceso
                        de transformación digital?
                    </p>
                    <input class="color" type="number" name="pregunta2" id="segunda3">
                </div>

                <div class="pregunta3">
                    <p>8-¿La tecnología implementada por la entidad incentiva las soluciones basadas en datos?
                    <h1 class="invisible">reyyeno </h1>
                    </p>
                    <input class="color" type="number" name="pregunta3" id="tercera1">
                </div>

                <div class="pregunta3">
                    <p>9-¿Cómo está la calidad de los datos en la entidad y qué tan confiable es la recolección,
                        tratamiento y uso de datos en la entidad soportada en las bases de datos?
                    </p>
                    <input class="color" type="number" name="pregunta3" id="tercera2">
                </div>

                <div class="pregunta3">
                    <p>10-¿Están las bases de datos protegidas por tecnologías y procesos en materia de seguridad y
                        privacidad de la información?
                    </p>
                    <input class="color" type="number" name="pregunta3" id="tercera3">
                </div>

                <div class="pregunta3">
                    <p>11-¿Las bases de datos son utilizadas para la toma de decisiones por las distintas áreas de la
                        entidad?
                    </p>
                    <input class="color" type="number" name="pregunta3" id="tercera4">
                </div>

                <div class="pregunta4">
                    <p>12-¿Las tecnologías actuales son lo suficientemente robustas para suplir las necesidades de los
                        usuarios al interior de la entidad?
                    </p>
                    <input class="color" type="number" name="pregunta4" id="cuarta1">
                </div>

                <div class="pregunta4">
                    <p>13-¿Las tecnologías actuales son lo suficientemente robustas para suplir las necesidades en la
                        interacción con la ciudadanía?
                    </p>
                    <input class="color" type="number" name="pregunta4" id="cuarta2">
                </div>

                <div class="pregunta4">
                    <p>14-¿Conoce las tecnologías más relevantes que tengo implementadas en mis procesos core?
                        (Tecnologías indispensables para el funcionamiento de la organización)
                    </p>
                    <input class="color" type="number" name="pregunta4" id="cuarta3">
                </div>
                <div class="pregunta4">
                    <p>15-¿Conoce las tecnologías correspondientes a la cuarta revolución industrial para potenciar la
                        eficiencia y eficacia de los principales procesos y para mejorar la interacción con la
                        ciudadanía?
                    </p>
                    <input class="color" type="number" name="pregunta4" id="cuarta4">
                </div>


                <div class="pregunta4">
                    <p>16-¿Existen al interior brechas entre las tecnologías actuales de la entidad y las tecnologías de
                        la cuarta revolución industrial, para suplir las necesidades de los procesos core?
                    </p>
                    <input class="color" type="number" name="pregunta4" id="cuarta5">
                </div>

                <div class="pregunta4">
                    <p>17-¿Se identifican los tiempos, riesgos y costos requeridos para la implementación y adaptación
                        de las tecnologías de la cuarta revolución industrial en los procesos core de la entidad?
                    </p>
                    <input class="color" type="number" name="pregunta4" id="cuarta6">
                </div>







                <input type="submit">
            </form>
        </div>
    </div>

    <div id="errorplus">¡Error! El valor debe estar entre 0 y 4.</div>


    <link rel="stylesheet" href="/css/envio.css">
    <script src="./js/script.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>


        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("formularioEncuesta").addEventListener("submit", function (event) {
                event.preventDefault(); // Evitar el envío por defecto del formulario

                let allItems = [];
                let isValid = true;
                const ouItem = document.querySelectorAll('input');
                Array.from(ouItem).map((r) => {
                    let item = '';
                    let last = 0;
                    let ids = r.getAttribute('id');
                    if (ids != null) {
                        if (ids.includes("primera")) {
                            last = ids[ids.length - 1];
                            allItems.push({ type: 'primera', item: parseInt(last), value: parseInt(r.value) });
                        }
                        if (ids.includes("segunda")) {
                            last = ids[ids.length - 1];
                            allItems.push({ type: 'segunda', item: parseInt(last), value: parseInt(r.value) });
                        }
                        if (ids.includes("tercera")) {
                            last = ids[ids.length - 1];
                            allItems.push({ type: 'tercera', item: parseInt(last), value: parseInt(r.value) });
                        }
                        if (ids.includes("cuarta")) {
                            last = ids[ids.length - 1];
                            allItems.push({ type: 'cuarta', item: parseInt(last), value: parseInt(r.value) });
                        }
                    }
                });

                const onlyType = allItems.filter((a) => a.type.includes('primera'));
                const arraicito = [];
                onlyType.map((r) => {
                    arraicito.push(r.value);
                });
                let sum = arraicito.reduce((previous, current) => current += previous);
                let avgPrimera = sum / onlyType.length;

                console.log(sum, avgPrimera);

                const onlyType2 = allItems.filter((a) => a.type.includes('segunda'));
                const arraicito2 = [];
                onlyType2.map((r) => {
                    arraicito2.push(r.value);
                });
                let sum2 = arraicito2.reduce((previous, current) => current += previous);
                let avgPrimera2 = sum2 / onlyType2.length;

                console.log(sum2, avgPrimera2);

                const onlyType3 = allItems.filter((a) => a.type.includes('tercera'));
                const arraicito3 = [];
                onlyType3.map((r) => {
                    arraicito3.push(r.value);
                });

                let sum3 = arraicito3.reduce((previous, current) => current += previous);
                let avgPrimera3 = sum3 / onlyType3.length;

                console.log(sum3, avgPrimera3);

                const onlyType4 = allItems.filter((a) => a.type.includes('cuarta'));
                const arraicito4 = [];
                onlyType4.map((r) => {
                    arraicito4.push(r.value);
                });
                let sum4 = arraicito4.reduce((previous, current) => current += previous);
                let avgPrimera4 = sum4 / onlyType4.length;

                console.log(sum4, avgPrimera4);



                console.log(Math.round(avgPrimera));
                console.log(Math.round(avgPrimera2));
                console.log(Math.round(avgPrimera3));
                console.log(Math.round(avgPrimera4));



                const data = {
                    avgPrimera: Math.round(avgPrimera),
                    avgPrimera2: Math.round(avgPrimera2),
                    avgPrimera3: Math.round(avgPrimera3),
                    avgPrimera4: Math.round(avgPrimera4),

                };


                fetch('http://localhost:3000/puntuacion', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',

                    },
                    body: JSON.stringify(data)
                })
                .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            console.log('Encuesta enviada correctamente:', data);
            window.location.href = "grafico.html";
            // Aquí puedes realizar cualquier acción adicional después de enviar la encuesta
        })
        .catch(error => {
            console.error('Error al enviar la encuesta:', error);
            // Manejo de errores
        });
    });
});



    </script>





</html>